<h2>Reviews for "<%= @assignment.name %>"</h2>

<!-- Added the feature to find the reviews and meta-reviews left for students by E1839 @Rayan Dasoriya -->
<% if @assignment.num_reviews_allowed.nil? || @assignment.num_reviews_allowed == -1%>
    <h4>Your instructor expects you to do <%= @assignment.num_reviews_required %> reviews. You are not allowed to do any extra reviews. </h4>

<% elsif @assignment.num_reviews_allowed == @assignment.num_reviews_required %>
    <h4>You should perform exactly <%= @assignment.num_reviews_allowed %> reviews </h4>
<% else %>

    <h4>You may perform between <%= @assignment.num_reviews_required %> and <%= @assignment.num_reviews_allowed %> reviews</h4>
<% end %>
<h4>You are required to do <%= @assignment.num_reviews_required %> reviews</h4>
<h4> Number of reviews left: <%= @assignment.num_reviews_allowed - @num_reviews_completed %></h4>

<% if check_reviewable_topics(@assignment) or @assignment.get_current_stage(@topic_id) == "Finished" %>
    <%= render :partial => 'responses', :locals => {:mappings => @review_mappings, :title => 'Review'} %>
    <!-- Temporary fix for Staggered Deadline assignment issue preventing students from reviewing 04-23-19 -->
    <!-- We need to perform the same check, but on the topic that is being reviewed and not the topic that the reviewer wrote on -->
    <% if @assignment.staggered_deadline? or @assignment.number_of_current_round(@topic_id) == 1 or (@assignment.number_of_current_round(@topic_id) > 1 and @assignment.allow_selecting_additional_reviews_after_1st_round) %>   
      <% if @assignment.dynamic_reviewer_assignment? %>
          <% if @num_reviews_in_progress >= Assignment.max_outstanding_reviews %>
              <br><br>
              <span>Note: You can't have more than 2 outstanding reviews. You must complete one of your outstanding reviews before selecting another.</span>
          <% elsif @assignment.num_reviews && @assignment.num_reviews >= 0 && @num_reviews_total >= @assignment.num_reviews%>
              <br><br>
              <span>Note: You can't do more than <%=@assignment.num_reviews%> reviews according to assignment policy.</span>
          <%else %>
            <%= render :partial => 'set_dynamic_review', :locals => {:assignment => @assignment, :participant => @participant} %>
          <% end %>

      <% end %>
    <% end %>
<% else %>
    <p><em>Reviews cannot be performed at this time</em></p >
<% end %>

<% if @assignment.metareview_allowed(@topic_id)%>
    <h2>Meta-reviews for "<%= @assignment.name %>"</h2>

    <% if @assignment.num_metareviews_required.nil? || @assignment.num_metareviews_required == -1 %>
        <h4>Your instructor has made meta-reviews optional. You are not required to complete any meta-reviews</h4>
        <% if @assignment.num_metareviews_allowed.nil? || @assignment.num_metareviews_allowed == -1 %>
            <h4>There is no limit on the number of meta-reviews you may complete.</h4>
        <% else %>
            <h4>You may complete as many as <%= @assignment.num_meta_reviews_allowed %> meta-reviews.</h4>
            <h4>Number of meta-reviews left: <%= @assignment.num_metareviews_allowed - @num_metareviews_total %></h4>
        <% end %>
    <% else %>
      <% if @assignment.num_metareviews_allowed.nil? || @assignment.num_metareviews_allowed == -1%>
          <h4>Your instructor expects you to complete at least <%= @assignment.num_metareviews_required %> meta-reviews.</h4>
          <h4>There is no limit on the number of meta-reviews you can perform.</h4>
      <% elsif @assignment.num_metareviews_allowed == @assignment.num_metareviews_required %>
          <h4>You should perform exactly <%= @assignment.num_metareviews_allowed %> meta-reviews </h4>
      <% else %>
          <h4>You may perform between <%= @assignment.num_metareviews_required %> and <%= @assignment.num_metareviews_allowed %> meta-reviews</h4>
      <% end %>
      <h4>You are required to do <%= @assignment.num_metareviews_required %> meta-reviews</h4>
      <% if !@assignment.num_metareviews_allowed.nil? && @assignment.num_metareviews_allowed != -1 %>
        <h4>Number of meta-reviews left: <%= @assignment.num_metareviews_allowed - @num_metareviews_total %></h4>
      <% end %>
    <% end %>

  <%= render :partial => 'responses', :locals => {:mappings => @metareview_mappings, :title => 'Meta-review'} %>
    <br/>
    <% if @num_metareviews_in_progress >= Assignment.max_outstanding_reviews %>
        <br/>
        <span>Note: You can't have more than 2 outstanding meta-reviews. You must complete one of your outstanding meta-reviews before selecting another.</span>
    <% elsif @assignment.num_metareviews_allowed && @num_metareviews_total == @assignment.num_metareviews_allowed %>
        <br/>
        <span>Note: You can not do more than <%=@assignment.num_metareviews_allowed%> meta-reviews according to assignment policy.</span>
    <% elsif (!@assignment.metareview_available?(session[:user].id)) %>
        <p><em>Meta-reviews cannot be performed at this time.</em></p>
    <% else %>
        <%= render :partial => 'set_dynamic_metareview', :locals => {:assignment => @assignment} %>
    <% end %>
<% end %>
<br><br>
<a href="javascript:window.history.back()">Back</a>
